---
title: Utils
layout: api
breadcrumb: ['api/Thruk/', 'Thruk']
---





<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#parse_date">parse_date</a></li>
      <li><a href="#format_date">format_date</a></li>
      <li><a href="#format_number">format_number</a></li>
      <li><a href="#format_cronentry">format_cronentry</a></li>
      <li><a href="#read_cgi_cfg">read_cgi_cfg</a></li>
      <li><a href="#is_valid_regular_expression">is_valid_regular_expression</a></li>
      <li><a href="#calculate_overall_processinfo">calculate_overall_processinfo</a></li>
      <li><a href="#get_start_end_for_timeperiod">get_start_end_for_timeperiod</a></li>
      <li><a href="#get_start_end_for_timeperiod_from_param">get_start_end_for_timeperiod_from_param</a></li>
      <li><a href="#get_dynamic_roles">get_dynamic_roles</a></li>
      <li><a href="#set_dynamic_roles">set_dynamic_roles</a></li>
      <li><a href="#set_message">set_message</a></li>
      <li><a href="#append_message">append_message</a></li>
      <li><a href="#ssi_include">ssi_include</a></li>
      <li><a href="#read_ssi">read_ssi</a></li>
      <li><a href="#read_resource_file">read_resource_file</a></li>
      <li><a href="#version_compare">version_compare</a></li>
      <li><a href="#combine_filter">combine_filter</a></li>
      <li><a href="#array2hash">array2hash</a></li>
      <li><a href="#set_paging_steps">set_paging_steps</a></li>
      <li><a href="#get_custom_vars">get_custom_vars</a></li>
      <li><a href="#set_custom_vars">set_custom_vars</a></li>
      <li><a href="#normal_mktime">normal_mktime</a></li>
      <li><a href="#get_user_data">get_user_data</a></li>
      <li><a href="#store_user_data">store_user_data</a></li>
      <li><a href="#get_global_user_data">get_global_user_data</a></li>
      <li><a href="#store_global_user_data">store_global_user_data</a></li>
      <li><a href="#array_uniq">array_uniq</a></li>
      <li><a href="#logs2xls">logs2xls</a></li>
      <li><a href="#savexls">savexls</a></li>
      <li><a href="#get_pnp_url">get_pnp_url</a></li>
      <li><a href="#get_histou_url">get_histou_url</a></li>
      <li><a href="#get_graph_url">get_graph_url</a></li>
      <li><a href="#get_perf_image">get_perf_image</a></li>
      <li><a href="#get_fake_session">get_fake_session</a></li>
      <li><a href="#get_action_url">get_action_url</a></li>
      <li><a href="#list">list</a></li>
      <li><a href="#translate_host_status">translate_host_status</a></li>
      <li><a href="#choose_mobile">choose_mobile</a></li>
      <li><a href="#update_cron_file">update_cron_file</a></li>
      <li><a href="#get_cron_time_entry">get_cron_time_entry</a></li>
      <li><a href="#set_user">set_user</a></li>
      <li><a href="#switch_realuser">switch_realuser</a></li>
      <li><a href="#check_pid_file">check_pid_file</a></li>
      <li><a href="#restart_later">restart_later</a></li>
      <li><a href="#wait_after_reload">wait_after_reload</a></li>
      <li><a href="#get_cron_entries_from_param">get_cron_entries_from_param</a></li>
      <li><a href="#read_data_file">read_data_file</a></li>
      <li><a href="#write_data_file">write_data_file</a></li>
      <li><a href="#backup_data_file">backup_data_file</a></li>
      <li><a href="#decode_any">decode_any</a></li>
      <li><a href="#ensure_utf8">ensure_utf8</a></li>
      <li><a href="#which">which</a></li>
      <li><a href="#reduce_number">reduce_number</a></li>
      <li><a href="#get_template_variable">get_template_variable</a></li>
      <li><a href="#precompile_templates">precompile_templates</a></li>
      <li><a href="#find_files">find_files</a></li>
      <li><a href="#beautify_diff">beautify_diff</a></li>
      <li><a href="#check_memory_usage">check_memory_usage</a></li>
      <li><a href="#base_folder">base_folder</a></li>
      <li><a href="#is_post">is_post</a></li>
      <li><a href="#check_csrf">check_csrf</a></li>
      <li><a href="#get_plugin_name">get_plugin_name</a></li>
      <li><a href="#backends_list_to_hash">backends_list_to_hash</a></li>
      <li><a href="#backends_hash_to_list">backends_hash_to_list</a></li>
    </ul>
  </li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#LICENSE">LICENSE</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Thruk::Utils - Utilities Collection for Thruk</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>Utilities Collection for Thruk</p>

<h1 id="METHODS">METHODS</h1>

<h2 id="parse_date">parse_date</h2>

<pre><code>  my $timestamp = parse_date($c, $string)</code></pre>

<p>Format: 2010-03-02 00:00:00 parse given date and return timestamp</p>

<h2 id="format_date">format_date</h2>

<pre><code>  my $date_string = format_date($string, $format)</code></pre>

<p>return date from timestamp in given format</p>

<h2 id="format_number">format_number</h2>

<pre><code>  my $string = format_number($number)</code></pre>

<p>return number with thousands seperator</p>

<h2 id="format_cronentry">format_cronentry</h2>

<pre><code>  my $cron_string = format_cronentry($cron_entry)</code></pre>

<p>return cron entry as string</p>

<h2 id="read_cgi_cfg">read_cgi_cfg</h2>

<pre><code>  read_cgi_cfg($c);</code></pre>

<p>parse the cgi.cfg and put it into $c-&gt;config</p>

<h2 id="is_valid_regular_expression">is_valid_regular_expression</h2>

<pre><code>  my $result = is_valid_regular_expression($expression)</code></pre>

<p>return true if this is a valid regular expression</p>

<h2 id="calculate_overall_processinfo">calculate_overall_processinfo</h2>

<pre><code>  my $process_info = calculate_overall_processinfo($process_info)</code></pre>

<p>computes a combined status for process infos</p>

<h2 id="get_start_end_for_timeperiod">get_start_end_for_timeperiod</h2>

<pre><code>  my($start, $end) = get_start_end_for_timeperiod($c,
                                                  $timeperiod,
                                                  $smon,
                                                  $sday,
                                                  $syear,
                                                  $shour,
                                                  $smin,
                                                  $ssec,
                                                  $emon,
                                                  $eday,
                                                  $eyear,
                                                  $ehour,
                                                  $emin,
                                                  $esec,
                                                  $t1,
                                                  $t2);</code></pre>

<p>returns a start and end timestamp for a report date definition</p>

<h2 id="get_start_end_for_timeperiod_from_param">get_start_end_for_timeperiod_from_param</h2>

<pre><code>  my($start, $end) = get_start_end_for_timeperiod_from_param($c)</code></pre>

<p>returns a start and end timestamp for a report date definition will use cgi params for input</p>

<h2 id="get_dynamic_roles">get_dynamic_roles</h2>

<pre><code>  get_dynamic_roles($c, $user)</code></pre>

<p>gets the authorized_for_read_only role and group based roles</p>

<h2 id="set_dynamic_roles">set_dynamic_roles</h2>

<pre><code>  set_dynamic_roles($c)</code></pre>

<p>sets the authorized_for_read_only role and group based roles</p>

<h2 id="set_message">set_message</h2>

<pre><code>  set_message($c, $style, $text, [ $details ])</code></pre>

<p>set a message in an cookie for later display</p>

<h2 id="append_message">append_message</h2>

<pre><code>  append_message($text)</code></pre>

<p>append text to current message</p>

<h2 id="ssi_include">ssi_include</h2>

<pre><code>  ssi_include($c)</code></pre>

<p>puts the ssi templates into the stash</p>

<h2 id="read_ssi">read_ssi</h2>

<pre><code>  read_ssi($c, $page, $type)</code></pre>

<p>finds all ssi files for a page of the specified type and returns the ssi content. Executable ssi files are executed and the output is appended to the ssi content. Otherwise the content of the ssi file is appende to the ssi content.</p>

<h2 id="read_resource_file">read_resource_file</h2>

<pre><code>  read_resource_file($file, [ $macros ], [$with_comments])</code></pre>

<p>returns a hash with all USER1-32 macros. macros can be a predefined hash.</p>

<h2 id="version_compare">version_compare</h2>

<pre><code>  version_compare($version1, $version2)</code></pre>

<p>compare too version strings and return 1 if v1 &gt;= v2</p>

<h2 id="combine_filter">combine_filter</h2>

<pre><code>  combine_filter($operator, $filter)</code></pre>

<p>combine filter by operator</p>

<h2 id="array2hash">array2hash</h2>

<pre><code>  array2hash($data, [ $key, [ $key2 ]])</code></pre>

<p>create a hash by key</p>

<h2 id="set_paging_steps">set_paging_steps</h2>

<pre><code>  set_paging_steps($c, $data)</code></pre>

<p>sets the pagins stepts, needs string like:</p>

<pre><code>  *100, 500, 1000, all</code></pre>

<h2 id="get_custom_vars">get_custom_vars</h2>

<pre><code>  get_custom_vars($c, $obj, [$prefix], [$add_host])</code></pre>

<p>return custom variables in a hash</p>

<h2 id="set_custom_vars">set_custom_vars</h2>

<pre><code>  set_custom_vars($c)</code></pre>

<p>set stash value for all allowed custom variables</p>

<h2 id="normal_mktime">normal_mktime</h2>

<pre><code>  normal_mktime($year,$mon,$day,$hour,$min,$sec)</code></pre>

<p>returns normalized timestamp for given date</p>

<h2 id="get_user_data">get_user_data</h2>

<pre><code>  get_user_data($c)</code></pre>

<p>returns user data</p>

<h2 id="store_user_data">store_user_data</h2>

<pre><code>  store_user_data($c, $data)</code></pre>

<p>store user data for section</p>

<h2 id="get_global_user_data">get_global_user_data</h2>

<pre><code>  get_global_user_data($c)</code></pre>

<p>returns global user data</p>

<h2 id="store_global_user_data">store_global_user_data</h2>

<pre><code>  store_global_user_data($c, $data)</code></pre>

<p>store global user data for section</p>

<h2 id="array_uniq">array_uniq</h2>

<pre><code>  array_uniq($array)</code></pre>

<p>return uniq elements of array</p>

<h2 id="logs2xls">logs2xls</h2>

<pre><code>  logs2xls($c)</code></pre>

<p>save excel file by background job</p>

<h2 id="savexls">savexls</h2>

<pre><code>  savexls($c)</code></pre>

<p>save excel file by background job</p>

<h2 id="get_pnp_url">get_pnp_url</h2>

<pre><code>  get_pnp_url($c, $object)</code></pre>

<p>return pnp url for object (host/service)</p>

<h2 id="get_histou_url">get_histou_url</h2>

<pre><code>  get_histou_url($c, $object)</code></pre>

<p>return histou url for object (host/service)</p>

<h2 id="get_graph_url">get_graph_url</h2>

<pre><code>  get_graph_url($c, $object)</code></pre>

<p>return graph url for object (host/service)</p>

<h2 id="get_perf_image">get_perf_image</h2>

<pre><code>  get_perf_image($c, $hst, $svc, $start, $end, $width, $height, $source, $resize_grafana_images, $format)</code></pre>

<p>return raw pnp/grafana image if possible. An empty string will be returned if no graph can be exported.</p>

<h2 id="get_fake_session">get_fake_session</h2>

<pre><code>  get_fake_session($c)</code></pre>

<p>create and return fake session id for current user</p>

<h2 id="get_action_url">get_action_url</h2>

<pre><code>  get_action_url($c, $escape_fun, $remove_render, $action_url, $host, $svc)</code></pre>

<p>return action_url modified for object (host/service) if we use graphite escape_fun is use to escape special char (html or quotes) remove_render remove /render in action url</p>

<h2 id="list">list</h2>

<pre><code>  list($ref)</code></pre>

<p>return list of ref unless it is already a list</p>

<h2 id="translate_host_status">translate_host_status</h2>

<pre><code>  translate_host_status($status)</code></pre>

<p>return name for status</p>

<h2 id="choose_mobile">choose_mobile</h2>

<pre><code>  choose_mobile($c, $url)</code></pre>

<p>let the user choose a mobile page or not</p>

<h2 id="update_cron_file">update_cron_file</h2>

<pre><code>  update_cron_file($c, $section, $entries)</code></pre>

<p>write crontab section</p>

<h2 id="get_cron_time_entry">get_cron_time_entry</h2>

<pre><code>  get_cron_time_entry($cronentry)</code></pre>

<p>return time part of crontab entry</p>

<h2 id="set_user">set_user</h2>

<pre><code>  set_user($c, $username)</code></pre>

<p>set and authenticate a user</p>

<h2 id="switch_realuser">switch_realuser</h2>

<pre><code>  switch_realuser($uid, $groups)</code></pre>

<p>switch real user and groups</p>

<h2 id="check_pid_file">check_pid_file</h2>

<pre><code>  check_pid_file($c)</code></pre>

<p>check and write pid file if none exists</p>

<h2 id="restart_later">restart_later</h2>

<pre><code>  restart_later($c, $redirect_url)</code></pre>

<p>restart fcgi process and redirects to given page</p>

<h2 id="wait_after_reload">wait_after_reload</h2>

<pre><code>  wait_after_reload($c, [$backend], [$timestamp])</code></pre>

<p>wait up to 60 seconds till the core responds</p>

<h2 id="get_cron_entries_from_param">get_cron_entries_from_param</h2>

<pre><code>  get_cron_entries_from_param($cronentry)</code></pre>

<p>return array of cron entries from param</p>

<h2 id="read_data_file">read_data_file</h2>

<pre><code>  read_data_file($filename)</code></pre>

<p>return data for datafile</p>

<h2 id="write_data_file">write_data_file</h2>

<pre><code>  write_data_file($filename, $data, [$changed_only])</code></pre>

<p>write data to datafile</p>

<h2 id="backup_data_file">backup_data_file</h2>

<pre><code>  backup_data_file($filename, $targetfile, $mode, $max_backups, [$save_interval], [$force])</code></pre>

<p>write data to datafile</p>

<h2 id="decode_any">decode_any</h2>

<p>read and decode string from either utf-8 or iso-8859-1</p>

<h2 id="ensure_utf8">ensure_utf8</h2>

<pre><code>    ensure_utf8($str)</code></pre>

<p>makes sure the given string is utf8</p>

<h2 id="which">which</h2>

<pre><code>    which($prog)</code></pre>

<p>returns path to program or undef</p>

<h2 id="reduce_number">reduce_number</h2>

<pre><code>  reduce_number($number, $unit, [$divisor])</code></pre>

<p>return reduced number, ex 1024B -&gt; 1KB</p>

<h2 id="get_template_variable">get_template_variable</h2>

<pre><code>  get_template_variable($c, $template, $variable)</code></pre>

<p>return variable defined from template</p>

<h2 id="precompile_templates">precompile_templates</h2>

<pre><code>  precompile_templates($c)</code></pre>

<p>precompile and load templates into memory</p>

<h2 id="find_files">find_files</h2>

<pre><code>  find_files($folder, $pattern)</code></pre>

<p>return list of files for folder and pattern</p>

<h2 id="beautify_diff">beautify_diff</h2>

<pre><code>  beautify_diff($text)</code></pre>

<p>make diff output beauty</p>

<h2 id="check_memory_usage">check_memory_usage</h2>

<pre><code>  check_memory_usage($c)</code></pre>

<p>check if memory limit is above the threshold</p>

<h2 id="base_folder">base_folder</h2>

<pre><code>    base_folder($c)</code></pre>

<p>return base etc folder</p>

<h2 id="is_post">is_post</h2>

<pre><code>    is_post($c)</code></pre>

<p>make sure this is a post request</p>

<h2 id="check_csrf">check_csrf</h2>

<pre><code>    check_csrf($c)</code></pre>

<p>ensure valid cross site request forgery token</p>

<h2 id="get_plugin_name">get_plugin_name</h2>

<pre><code>    get_plugin_name(__FILE__, __PACKAGE__)</code></pre>

<p>returns the name of the plugin</p>

<h2 id="backends_list_to_hash">backends_list_to_hash</h2>

<pre><code>    backends_list_to_hash($c, $list)</code></pre>

<p>returns array of backend ids converted as list of hashes</p>

<h2 id="backends_hash_to_list">backends_hash_to_list</h2>

<pre><code>    backends_hash_to_list($c, $hashlist)</code></pre>

<p>returns array of backends (inverts backends_list_to_hash function)</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Sven Nierlein, 2009-present, &lt;sven@nierlein.org&gt;</p>

<h1 id="LICENSE">LICENSE</h1>

<p>This library is free software, you can redistribute it and/or modify it under the same terms as Perl itself.</p>


