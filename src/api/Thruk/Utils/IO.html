---
title: IO
layout: api
breadcrumb: ['api/Thruk/', 'Thruk', 'api/Thruk/Utils/', 'Utils']
---





<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#close">close</a></li>
      <li><a href="#mkdir">mkdir</a></li>
      <li><a href="#mkdir_r">mkdir_r</a></li>
      <li><a href="#read">read</a></li>
      <li><a href="#read_decoded">read_decoded</a></li>
      <li><a href="#saferead">saferead</a></li>
      <li><a href="#read_as_list">read_as_list</a></li>
      <li><a href="#saferead_as_list">saferead_as_list</a></li>
      <li><a href="#write">write</a></li>
      <li><a href="#ensure_permissions">ensure_permissions</a></li>
      <li><a href="#file_rlock">file_rlock</a></li>
      <li><a href="#file_lock">file_lock</a></li>
      <li><a href="#file_unlock">file_unlock</a></li>
      <li><a href="#json_store">json_store</a></li>
      <li><a href="#json_lock_store">json_lock_store</a></li>
      <li><a href="#json_retrieve">json_retrieve</a></li>
      <li><a href="#json_lock_retrieve">json_lock_retrieve</a></li>
      <li><a href="#json_lock_patch">json_lock_patch</a></li>
      <li><a href="#json_patch">json_patch</a></li>
      <li><a href="#save_logs_to_tempfile">save_logs_to_tempfile</a></li>
      <li><a href="#cmd">cmd</a></li>
      <li><a href="#untaint">untaint</a></li>
      <li><a href="#realpath">realpath</a></li>
      <li><a href="#touch">touch</a></li>
      <li><a href="#merge_deep">merge_deep</a></li>
      <li><a href="#get_memory_usage">get_memory_usage</a></li>
      <li><a href="#find_files">find_files</a></li>
      <li><a href="#all_perl_files">all_perl_files</a></li>
      <li><a href="#dclone">dclone</a></li>
    </ul>
  </li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Thruk::Utils::IO - IO Utilities Collection for Thruk</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>IO Utilities Collection for Thruk</p>

<h1 id="METHODS">METHODS</h1>

<h2 id="close">close</h2>

<pre><code>close($fh, $filename, $just_close)</code></pre>

<p>close filehandle and ensure permissions and ownership</p>

<h2 id="mkdir">mkdir</h2>

<pre><code>mkdir($dirname)</code></pre>

<p>create folder and ensure permissions and ownership</p>

<h2 id="mkdir_r">mkdir_r</h2>

<pre><code>mkdir_r($dirname)</code></pre>

<p>create folder recursive</p>

<h2 id="read">read</h2>

<pre><code>read($path)</code></pre>

<p>read file and return content</p>

<h2 id="read_decoded">read_decoded</h2>

<pre><code>read_decoded($path)</code></pre>

<p>read file and return decoded content</p>

<h2 id="saferead">saferead</h2>

<pre><code>saferead($path)</code></pre>

<p>read file and return content or undef in case it cannot be read</p>

<h2 id="read_as_list">read_as_list</h2>

<pre><code>read_as_list($path)</code></pre>

<p>read file and return content as array</p>

<h2 id="saferead_as_list">saferead_as_list</h2>

<pre><code>saferead_as_list($path)</code></pre>

<p>read file and return content as array, return empty list if open fails</p>

<h2 id="write">write</h2>

<pre><code>write($path, $content, [ $mtime ], [ $append ])</code></pre>

<p>creates file and ensure permissions</p>

<h2 id="ensure_permissions">ensure_permissions</h2>

<pre><code>ensure_permissions($mode, $path)</code></pre>

<p>ensure permissions and ownership</p>

<h2 id="file_rlock">file_rlock</h2>

<pre><code>file_rlock($file)</code></pre>

<p>locks given file in shared / readonly mode. Returns filehandle.</p>

<h2 id="file_lock">file_lock</h2>

<pre><code>file_lock($file)</code></pre>

<p>locks given file in read/write mode. Returns locked filehandle and lock file handle.</p>

<h2 id="file_unlock">file_unlock</h2>

<pre><code>file_unlock($file, $fh, $lock_fh)</code></pre>

<p>unlocks file lock previously with file_lock exclusivly. Returns nothing.</p>

<h2 id="json_store">json_store</h2>

<pre><code>json_store($file, $data, $options)</code></pre>

<p>stores data json encoded</p>

<p>$options can be { pretty =&gt; 0/1, # don&#39;t write json into a single line and use human readable intendation tmpfile =&gt; &lt;filename&gt; # use this tmpfile while writing new contents changed_only =&gt; 0/1, # only write the file if it has changed compare_data =&gt; &quot;...&quot;, # use this string to compare for changed content skip_ensure_permissions =&gt; 0/1 # skip running ensure_permissions after write skip_validate =&gt; 0/1 # skip file validation (author only) skip_config =&gt; 0/1 # skip all steps which reqire thruk config }</p>

<h2 id="json_lock_store">json_lock_store</h2>

<pre><code>json_lock_store($file, $data, [$options])</code></pre>

<p>stores data json encoded. options are passed to json_store.</p>

<h2 id="json_retrieve">json_retrieve</h2>

<pre><code>json_retrieve($file, $fh, [$lock_fh])</code></pre>

<p>retrieve json data</p>

<h2 id="json_lock_retrieve">json_lock_retrieve</h2>

<pre><code>json_lock_retrieve($file)</code></pre>

<p>retrieve json data</p>

<h2 id="json_lock_patch">json_lock_patch</h2>

<pre><code>json_lock_patch($file, $patch_data, [$options])</code></pre>

<p>update json data with locking. options are passed to json_store.</p>

<h2 id="json_patch">json_patch</h2>

<pre><code>json_patch($file, $fh, $patch_data, [$options])</code></pre>

<p>update json data. options are passed to json_store.</p>

<h2 id="save_logs_to_tempfile">save_logs_to_tempfile</h2>

<pre><code>save_logs_to_tempfile($logs)</code></pre>

<p>save logfiles to tempfile</p>

<h2 id="cmd">cmd</h2>

<pre><code>cmd($command, [ $options ])</code></pre>

<p>run command and return exit code and output</p>

<p>$command can be either a string like &#39;/bin/prog arg1 arg2&#39; or an array like [&#39;/bin/prog&#39;, &#39;arg1&#39;, &#39;arg2&#39;]</p>

<p>options are:</p>

<pre><code>- stdin                 text used as stdin for the command
- print_prefix          print the result on the fly with given prefix.
- output_prefix         add prefix to output (can be a callback)
- detached              run the command detached in the background
- no_decode             skip decoding
- timeout               kill the command after the timeout (seconds)
- no_touch_signals      do not change signal handler
- env                   environment variables</code></pre>

<h2 id="untaint">untaint</h2>

<pre><code>untaint($var)</code></pre>

<p>return untainted variable</p>

<h2 id="realpath">realpath</h2>

<pre><code>realpath($file)</code></pre>

<p>return realpath of this file</p>

<h2 id="touch">touch</h2>

<pre><code>touch($file)</code></pre>

<p>create file if not exists and update timestamp</p>

<h2 id="merge_deep">merge_deep</h2>

<pre><code>merge_deep($var, $merge_var)</code></pre>

<p>returns merged variables</p>

<p>merge will be as follows:</p>

<pre><code>- hash keys will be replaced with the last level of hash keys
- arrays will will be replaced completely, unless $merge_var is a hash of
  the form: { array_index =&gt; replacement }
- everything else will be replaced</code></pre>

<h2 id="get_memory_usage">get_memory_usage</h2>

<pre><code>get_memory_usage([$pid])</code></pre>

<p>return memory usage of pid or own process if no pid specified</p>

<h2 id="find_files">find_files</h2>

<pre><code>find_files($folder, $pattern, $skip_symlinks)</code></pre>

<p>return list of files for folder and pattern (symlinks will be skipped)</p>

<h2 id="all_perl_files">all_perl_files</h2>

<pre><code>all_perl_files(@dirs)</code></pre>

<p>return list of all perl files for given folders</p>

<h2 id="dclone">dclone</h2>

<pre><code>dclone($obj)</code></pre>

<p>deep clones any object</p>


