---
title: IO
layout: api
breadcrumb: ['api/Thruk/', 'Thruk', 'api/Thruk/Utils/', 'Utils']
---





<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#close">close</a></li>
      <li><a href="#mkdir">mkdir</a></li>
      <li><a href="#mkdir_r">mkdir_r</a></li>
      <li><a href="#read">read</a></li>
      <li><a href="#write">write</a></li>
      <li><a href="#ensure_permissions">ensure_permissions</a></li>
      <li><a href="#file_lock">file_lock</a></li>
      <li><a href="#file_unlock">file_unlock</a></li>
      <li><a href="#json_store">json_store</a></li>
      <li><a href="#json_lock_store">json_lock_store</a></li>
      <li><a href="#json_retrieve">json_retrieve</a></li>
      <li><a href="#json_lock_retrieve">json_lock_retrieve</a></li>
      <li><a href="#json_lock_patch">json_lock_patch</a></li>
      <li><a href="#json_patch">json_patch</a></li>
      <li><a href="#save_logs_to_tempfile">save_logs_to_tempfile</a></li>
      <li><a href="#cmd">cmd</a></li>
      <li><a href="#untaint">untaint</a></li>
      <li><a href="#merge_deep">merge_deep</a></li>
    </ul>
  </li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Thruk::Utils - IO Utilities Collection for Thruk</p>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>IO Utilities Collection for Thruk</p>

<h1 id="METHODS">METHODS</h1>

<h2 id="close">close</h2>

<pre><code>  close($fh, $filename, $just_close)</code></pre>

<p>close filehandle and ensure permissions and ownership</p>

<h2 id="mkdir">mkdir</h2>

<pre><code>  mkdir($dirname)</code></pre>

<p>create folder and ensure permissions and ownership</p>

<h2 id="mkdir_r">mkdir_r</h2>

<pre><code>  mkdir_r($dirname)</code></pre>

<p>create folder recursive</p>

<h2 id="read">read</h2>

<pre><code>  read($path)</code></pre>

<p>read file and return content</p>

<h2 id="write">write</h2>

<pre><code>  write($path, $content, [ $mtime ], [ $append ])</code></pre>

<p>creates file and ensure permissions</p>

<h2 id="ensure_permissions">ensure_permissions</h2>

<pre><code>  ensure_permissions($mode, $path)</code></pre>

<p>ensure permissions and ownership</p>

<h2 id="file_lock">file_lock</h2>

<pre><code>  file_lock($file, $mode)

  $mode can be
    - &#39;ex&#39; exclusive
    - &#39;sh&#39; shared</code></pre>

<p>locks given file. Returns locked filehandle.</p>

<h2 id="file_unlock">file_unlock</h2>

<pre><code>  file_unlock($file, $fh)</code></pre>

<p>unlocks file lock previously with file_lock exclusivly. Returns nothing.</p>

<h2 id="json_store">json_store</h2>

<pre><code>  json_store($file, $data, [$pretty], [$changed_only])</code></pre>

<p>stores data json encoded</p>

<h2 id="json_lock_store">json_lock_store</h2>

<pre><code>  json_lock_store($file, $data, [$pretty], [$changed_only])</code></pre>

<p>stores data json encoded</p>

<h2 id="json_retrieve">json_retrieve</h2>

<pre><code>  json_retrieve($file, $fh)</code></pre>

<p>retrieve json data</p>

<h2 id="json_lock_retrieve">json_lock_retrieve</h2>

<pre><code>  json_lock_retrieve($file)</code></pre>

<p>retrieve json data</p>

<h2 id="json_lock_patch">json_lock_patch</h2>

<pre><code>  json_lock_patch($file, $patch_data, [$pretty], [$changed_only], [$tmpfile])</code></pre>

<p>update json data</p>

<h2 id="json_patch">json_patch</h2>

<pre><code>  json_patch($file, $fh, $patch_data, [$pretty], [$changed_only], [$tmpfile])</code></pre>

<p>update json data</p>

<h2 id="save_logs_to_tempfile">save_logs_to_tempfile</h2>

<pre><code>  save_logs_to_tempfile($logs)</code></pre>

<p>save logfiles to tempfile</p>

<h2 id="cmd">cmd</h2>

<pre><code>  cmd($c, $command [, $stdin] [, $print_prefix] [, $detached])</code></pre>

<p>run command and return exit code and output</p>

<p>$command can be either a string like &#39;/bin/prog arg1 arg2&#39; or an array like [&#39;/bin/prog&#39;, &#39;arg1&#39;, &#39;arg2&#39;]</p>

<p>optional print_prefix will print the result on the fly with given prefix.</p>

<p>optional detached will run the command detached in the background</p>

<h2 id="untaint">untaint</h2>

<pre><code>  untaint($var)</code></pre>

<p>return untainted variable</p>

<h2 id="merge_deep">merge_deep</h2>

<pre><code>  merge_deep($var, $merge_var)</code></pre>

<p>returns merged variables</p>

<p>merge will be as follows:</p>

<pre><code>    - hash keys will be replaced with the last level of hash keys
    - arrays will will be replaced completly, unless $merge_var is a hash of
      the form: { array_index =&gt; replacement }
    - everything else will be replaced</code></pre>


