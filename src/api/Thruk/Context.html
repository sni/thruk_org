---
title: Context
layout: api
breadcrumb: ['api/Thruk/', 'Thruk']
---





<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#METHODS">METHODS</a>
    <ul>
      <li><a href="#new">new</a></li>
      <li><a href="#request">request</a></li>
      <li><a href="#response">response</a></li>
      <li><a href="#cluster">cluster</a></li>
      <li><a href="#db">db</a></li>
      <li><a href="#metrics">metrics</a></li>
      <li><a href="#detach">detach</a></li>
      <li><a href="#detach_error">detach_error</a></li>
      <li><a href="#get_tt_template_paths">get_tt_template_paths</a></li>
      <li><a href="#render">render</a></li>
      <li><a href="#render_excel">render_excel</a></li>
      <li><a href="#render_gd">render_gd</a></li>
      <li><a href="#authenticate">authenticate</a></li>
      <li><a href="#request_username">_request_username</a></li>
      <li><a href="#user_exists">user_exists</a></li>
      <li><a href="#error">error</a></li>
      <li><a href="#clear_errors">clear_errors</a></li>
      <li><a href="#check_user_roles">check_user_roles</a></li>
      <li><a href="#check_permissions">check_permissions</a></li>
      <li><a href="#check_cmd_permissions">check_cmd_permissions</a></li>
      <li><a href="#cache">cache</a></li>
      <li><a href="#cookie">cookie</a></li>
      <li><a href="#cookies">cookies</a></li>
      <li><a href="#redirect_to">redirect_to</a></li>
      <li><a href="#redirect_to_detached">redirect_to_detached</a></li>
      <li><a href="#url_with">url_with</a></li>
      <li><a href="#translate_request_path">translate_request_path</a></li>
      <li><a href="#has_route">has_route</a></li>
      <li><a href="#sub_request">sub_request</a></li>
      <li><a href="#want_json_response">want_json_response</a></li>
      <li><a href="#clone_user_config">clone_user_config</a></li>
      <li><a href="#log">log</a></li>
      <li><a href="#get_cookie_domain">get_cookie_domain</a></li>
      <li><a href="#finalize_request">finalize_request</a></li>
      <li><a href="#set_stats_common_totals">set_stats_common_totals</a></li>
      <li><a href="#add_profile">add_profile</a></li>
    </ul>
  </li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Thruk::Context - Main Context Object</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>  use Thruk::Context;</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p><code>Thruk::Context</code> Main Context Object</p>

<h1 id="METHODS">METHODS</h1>

<h2 id="new">new</h2>

<pre><code>    new()</code></pre>

<p>return new context object</p>

<h2 id="request">request</h2>

<p>return request object</p>

<h2 id="response">response</h2>

<p>return response object</p>

<h2 id="cluster">cluster</h2>

<p>return cluster object</p>

<h2 id="db">db</h2>

<p>return db manager</p>

<h2 id="metrics">metrics</h2>

<p>return metrics object</p>

<h2 id="detach">detach</h2>

<p>detach to other controller</p>

<h2 id="detach_error">detach_error</h2>

<pre><code>  detach_error($c, $data)</code></pre>

<p>end current request with an error.</p>

<p>$data contains: { msg short error message descr long description of the error code http return code, defaults to 500; log flag wether error should be logged. Error codes &gt; 500 are automatically logged if `log` is undefined debug_information more details which will be logged, (string / array) skip_escape skip escaping html }</p>

<h2 id="get_tt_template_paths">get_tt_template_paths</h2>

<p>return list of template include paths</p>

<h2 id="render">render</h2>

<p>detach to other controller</p>

<h2 id="render_excel">render_excel</h2>

<p>detach to excel controller</p>

<h2 id="render_gd">render_gd</h2>

<p>detach to gd controller</p>

<h2 id="authenticate">authenticate</h2>

<pre><code>  $c-&gt;authenticate(%options)</code></pre>

<p>authenticate current request user</p>

<p>options are: { username =&gt; force this username skip_db_access =&gt; do not access the livestatus to fetch roles apikey =&gt; use api key to authenticate superuser =&gt; flag wether this user should be a superuser internal =&gt; flag wether this user is an internal technical user roles =&gt; limit roles to this set keep_session =&gt; do not update current session cookie }</p>

<h2 id="request_username">_request_username</h2>

<p>get username from env</p>

<p>returns $username, $auth_src, $roles, $superuser, $internal, $sessionid, $sessiondata</p>

<h2 id="user_exists">user_exists</h2>

<p>return if a user exists</p>

<h2 id="error">error</h2>

<p>return/set errors</p>

<h2 id="clear_errors">clear_errors</h2>

<p>clear all errors</p>

<h2 id="check_user_roles">check_user_roles</h2>

<p>$c-&gt;check_user_roles(&lt;role&gt;)</p>

<h2 id="check_permissions">check_permissions</h2>

<p>$c-&gt;check_permissions(&lt;type&gt;, ...)</p>

<h2 id="check_cmd_permissions">check_cmd_permissions</h2>

<p>$c-&gt;check_cmd_permissions(&lt;type&gt;, ...)</p>

<h2 id="cache">cache</h2>

<p>$c-&gt;cache()</p>

<h2 id="cookie">cookie</h2>

<p>$c-&gt;cookie($name, [$value], [$options])</p>

<p>returns cookie from current request.</p>

<p>sets a cookie for current response if value is defined.</p>

<p>options are available as descrbed here: <a href="https://metacpan.org/pod/Plack%3A%3AResponse#cookies">&quot;cookies&quot; in Plack::Response</a></p>

<p>basically: domain, expires, path, httponly, secure, max-age</p>

<h2 id="cookies">cookies</h2>

<p>$c-&gt;cookies($name)</p>

<p>returns cookie from current request.</p>

<h2 id="redirect_to">redirect_to</h2>

<p>$c-&gt;redirect_to(&lt;url&gt;)</p>

<h2 id="redirect_to_detached">redirect_to_detached</h2>

<p>$c-&gt;redirect_to_detached(&lt;url&gt;)</p>

<h2 id="url_with">url_with</h2>

<p>$c-&gt;url_with(&lt;data&gt;)</p>

<h2 id="translate_request_path">translate_request_path</h2>

<pre><code>    translate_request_path(&lt;path_info&gt;, $config, $env)</code></pre>

<p>translate paths, /naemon/cgi-bin to /thruk/cgi-bin/ or /&lt;omd-site/thruk/cgi-bin/... to /thruk/cgi-bin/... so later functions can use /thruk/... for everything, regardless of the deployment path.</p>

<h2 id="has_route">has_route</h2>

<p>$c-&gt;has_route(&lt;url&gt;)</p>

<h2 id="sub_request">sub_request</h2>

<p>$c-&gt;sub_request(&lt;url&gt;, [&lt;method&gt;], [&lt;postdata&gt;], [&lt;rendered&gt;])</p>

<h2 id="want_json_response">want_json_response</h2>

<p>$c-&gt;want_json_response()</p>

<p>returns true if request indicates a json response.</p>

<h2 id="clone_user_config">clone_user_config</h2>

<p>$c-&gt;clone_user_config()</p>

<p>replace $c-&gt;config with a deepcopy of it</p>

<h2 id="log">log</h2>

<p>$c-&gt;log-&gt;...</p>

<p>compat wrapper for accessing logger</p>

<h2 id="get_cookie_domain">get_cookie_domain</h2>

<p>$c-&gt;get_cookie_domain</p>

<p>return domain used for cookies</p>

<h2 id="finalize_request">finalize_request</h2>

<pre><code>    register_cron_entries($c, $res)</code></pre>

<p>finalize request data by adding profile and headers</p>

<h2 id="set_stats_common_totals">set_stats_common_totals</h2>

<p>$c-&gt;set_stats_common_totals</p>

<p>adds common statistics</p>

<h2 id="add_profile">add_profile</h2>

<p>$c-&gt;add_profile({ name =&gt; ..., [ text =&gt; \@txtprofiles ], [ html =&gt; \@htmlprofiles ] })</p>

<p>add profile to stash</p>


